version: '3.8'

services:
  carbon-frontend:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        # IMPORTANT: Use relative /api path so nginx can proxy and handle CORS
        # This avoids duplicate CORS headers from both nginx and API Gateway
        - VITE_API_URL=/api
        - VITE_APP_NAME=Carbon Credit Marketplace
        - VITE_APP_VERSION=1.0.0
    container_name: carbon-frontend
    ports:
      - "5173:80"
    environment:
      - NODE_ENV=production
    volumes:
      - ./nginx.standalone.conf:/etc/nginx/conf.d/default.conf:ro
    restart: unless-stopped
    networks:
      - microservices-network  # Use same network as backend
    # Note: Remove 'depends_on: backend' if using external network
    # Backend services are in separate docker-compose in carbon-backend/
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

# Connect to backend microservices network
# This network is created by carbon-backend/docker-compose.yml
networks:
  microservices-network:
    external: true
    # If network doesn't exist yet, remove 'external: true' and let it create
    # Then update carbon-backend/docker-compose.yml to use this network

